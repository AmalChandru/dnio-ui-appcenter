<div class="bg-light h-100">
  <div class="mx-3 mb-2 custom-filter-container bg-white ">
    <div class="d-flex flex-column w-100">
      <div class="d-flex align-items-start options p-3">
        <div class="text-gray-medium label-text">
          <strong>Filter</strong>
        </div>
        <div class="d-flex flex-column justify-content-center filter-options position-relative">
          <div class="d-flex align-items-center ignore-outside hover ignore-outside"
            [ngClass]="{'text-primary': placeHolderText !== 'Select Filter', 'text-secondary': placeHolderText === 'Select Filter'}"
            (click)="showFilterList = !showFilterList">
            <span class="ignore-outside">{{ placeHolderText }}</span>
            <span class="fas fa-angle-down ignore-outside ml-auto"></span>
          </div>
          <div *ngIf="showFilterList && allFilters?.length > 0; else noFilterTemp">
            <div class="filter-container mb-2 bg-white position-absolute w-100 ignore-outside" [@filterList]
              *ngIf="showFilterList" odpClickOutside [ignore]="['.ignore-outside']" (outside)="showFilterList = false">
              <div *ngFor="let filter of allFilters" class="p-2 hover filter-name text-secondary ignore-outside"
                (click)="selectFilter(filter)">
                {{ filter.name }}
              </div>
            </div>
          </div>
          <ng-template #noFilterTemp>
            <div *ngIf="showFilterList"
              class="filter-container mb-2 bg-white position-absolute ignore-outside w-100 ignore-outside font-sm p-2 text-secondary"
              odpClickOutside (outside)="showFilterList = false" [ignore]="['.ignore-outside']">
              No filters are defined for this service yet
            </div>
          </ng-template>
        </div>
      </div>


      <!-- <div class="d-flex align-items-start options p-3">
        <div class="text-gray-medium label-text">
          <strong>Type</strong>
        </div>
        <div class="d-flex">
          <label class="btn-container d-flex rounded align-items-center justify-content-between px-2 hover"
            [ngClass]="{'checked':filter.createFilter}">
            <div>
              <span class="fa fa-plus font-xsm  "></span>
              <span class="ml-2">New</span>
            </div>
            <label class="chk-container chk mb-4">
              <input type="checkbox" id='new' value="true" [checked]='filter.createFilter'
                (ngModelChange)="filterChange($event,'operation','POST')" [(ngModel)]="filter.createFilter">
              <span class="checkmark"></span>
            </label>
          </label>
          <label class="btn-container d-flex rounded align-items-center justify-content-between px-2 hover ml-2"
            [ngClass]="{'checked':filter.updateFilter}">
            <div>
              <span class="fa fa-pencil-alt font-xsm  "></span>
              <span class="ml-2">Edit</span>
            </div>
            <label class="chk-container chk mb-4">
              <input type="checkbox" id="edit" value="true" (ngModelChange)="filterChange($event,'operation','PUT')"
                [(ngModel)]="filter.updateFilter">
              <span class="checkmark"></span>
            </label>
          </label>

          <label class="btn-container d-flex rounded align-items-center justify-content-between px-2 hover ml-2"
            [ngClass]="{'checked':filter.deleteFilter}">
            <div>
              <span class="fa fa-trash font-xsm"></span>
              <span class="ml-2">Delete</span>
            </div>
            <label class="chk-container chk mb-4">
              <input type="checkbox" id="delete" (ngModelChange)="filterChange($event,'operation','DELETE')"
                [(ngModel)]="filter.deleteFilter">
              <span class="checkmark"></span>
            </label>
          </label>

        </div>
      </div> -->


      <!-- <div class="d-flex align-items-start options p-3">
        <div class="text-gray-medium label-text">
          <strong>Status</strong>
        </div>
        <div class="d-flex  flex-wrap">
          <label class="btn-container d-flex rounded align-items-center justify-content-between px-2 hover"
            [ngClass]="{'checked':filter.submitted}">
            <div class="d-flex align-items-center">
              <span class="odp-arrow-right text-primary font-sm "></span>
              <span class="ml-2">Pending Review</span>
            </div>
            <label class="chk-container chk mb-4">
              <input type="checkbox" id="submitted" value="true"
                (ngModelChange)="filterChange($event,'status','Pending')" [(ngModel)]="filter.submitted">
              <span class="checkmark"></span>
            </label>
          </label>
          <label class="btn-container d-flex rounded align-items-center justify-content-between px-2 hover ml-2"
            [ngClass]="{'checked':filter.discard}">
            <div class="d-flex align-items-center">
              <span class="ml-2">Discard</span>
            </div>
            <label class="chk-container chk mb-4">
              <input type="checkbox" id="discard" value="true"
                (ngModelChange)="filterChange($event,'status','Discarded')" [(ngModel)]="filter.discard">
              <span class="checkmark"></span>
            </label>
          </label>

          <label class="btn-container d-flex rounded align-items-center justify-content-between px-2 hover ml-2"
            [ngClass]="{'checked':filter.rework}">
            <div class="d-flex align-items-center">
              <span class="odp-rework font-sm text-warning "></span>
              <span class="ml-2">Rework</span>
            </div>
            <label class="chk-container chk mb-4">
              <input type="checkbox" id="rework" value="true" (ngModelChange)="filterChange($event,'status','Rework')"
                [(ngModel)]="filter.rework">
              <span class="checkmark"></span>
            </label>
          </label>

          <label class="btn-container d-flex rounded align-items-center justify-content-between px-2 hover ml-2"
            [ngClass]="{'checked':filter.approved}">
            <div class="d-flex align-items-center">
              <span class="odp-check text-success font-xsm  "></span>
              <span class="ml-2">Approved</span>
            </div>
            <label class="chk-container chk mb-4">
              <input type="checkbox" id="approved" value="true"
                (ngModelChange)="filterChange($event,'status','Approved')" [(ngModel)]="filter.approved">
              <span class="checkmark"></span>
            </label>
          </label>
          <label class="btn-container d-flex rounded align-items-center justify-content-between px-2 hover ml-2"
            [ngClass]="{'checked':filter.rejected}">
            <div class="d-flex align-items-center">
              <span class="odp-times text-danger font-xsm "></span>
              <span class="ml-2">Rejected</span>
            </div>
            <label class="chk-container chk mb-4">
              <input type="checkbox" id="rejected" value="true"
                (ngModelChange)="filterChange($event,'status','Rejected')" [(ngModel)]="filter.rejected">
              <span class="checkmark"></span>
            </label>
          </label>

          <label class="btn-container d-flex rounded align-items-center justify-content-between px-2 hover ml-2"
            [ngClass]="{'checked':filter.draft}">
            <div class="d-flex align-items-center">
              <span class="far fa-file  font-sm text-dark "></span>
              <span class="ml-2">Draft</span>
            </div>
            <label class="chk-container chk mb-4">
              <input type="checkbox" id="draft" value="true" (ngModelChange)="filterChange($event,'status','Draft')"
                [(ngModel)]="filter.draft">
              <span class="checkmark"></span>
            </label>
          </label>

        </div>
      </div> -->

      <!-- Column -->
      <div class="d-flex align-items-center px-3 pt-3">
        <div class="text-gray-medium label-text">
          <label for="columns">
            <strong>Columns</strong>
          </label>
        </div>
        <div class="col-2 p-0 position-relative mr-2">
          <input id="columns" type="text" class="form-control" [(ngModel)]="name" [ngbTypeahead]="search"
            (focus)="focus$.next($event.target.value)" (click)="click$.next($event.target.value)"
            [resultFormatter]="formatter" (selectItem)="selectItem($event)" placeholder="Choose from list"
            #inputInstance="ngbTypeahead" />
          <span class="fas fa-lg fa-plus-circle text-primary position-absolute" id="addColumn"></span>
        </div>
        <div class="helper-text text-muted" *ngIf="selectedColOrder?.length > 1">
          Click and drag the column names to re-arrange the order.
        </div>
      </div>
      <div class="d-flex m-2 align-items-start pl-2">
        <div class="text-gray-medium label-text"></div>
        <div class="d-flex flex-wrap">
          <!-- <div *ngFor="let col of defaultColums; let i = index; let last = last;" class="d-flex">
            <div class=" defaultColumns bg-light d-flex justify-content-center align-items-center mb-2 mr-2">
              <span class="font-xsm"
                [odpTruncated]="col?.properties?.label ? col?.properties?.label : col?.properties?.name">{{ col?.properties?.label ? col?.properties?.label : col?.properties?.name }}</span>
              <div class="remove-col  " >
                <span class="fas font-xsm fa-lg fa-times ml-2 mb-2"></span>
              </div>
            </div>
          </div> -->

          <div class="d-flex drag-boundary  flex-wrap" [sortablejs]="selectedColOrder">

            <div *ngFor="let col of selectedColOrder; let i = index; let last = last;" class="d-flex">
              <div
                class="col-name  d-flex justify-content-between bg-white d-flex justify-content-center align-items-center mb-2"
                [ngClass]="{'mr-2': !last}">
                <span class="ml-2 font-xsm"
                  [odpTruncated]="col?.properties?.label ? col?.properties?.label : col?.properties?.name">{{ col?.properties?.label ? col?.properties?.label : col?.properties?.name }}</span>
                <div class="remove-col hover pr-2" (click)="removeItem(i)">
                  <span class="fas font-xsm fa-lg fa-times mb-2"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Column -->

      <odp-search-for class="mb-3 pt-3 px-3" [serviceId]="serviceId" (searchForUpdate)="createFilter($event)"
        [searchForColumn]='searchForColumn' ></odp-search-for>

      <div class="d-flex options p-3" *ngIf="selectedColOrder.length">
        <div class="text-gray-medium label-text">
          <strong>Sort by</strong>
        </div>
        <div class="d-flex flex-column" [sortablejs]="sortingColumns">
          <div class="d-flex align-items-center row-content mb-2" *ngFor="let col of sortingColumns; let i1 = index">
            <div class="fas fa-bars text-muted mr-2 hover"></div>
            <div class="input-group col-name-dd mr-2">
              <select class="custom-select" [(ngModel)]="col.name">
                <option value="" class="d-none" selected>Select column</option>
                <option *ngFor="let selCol of selectedColOrder;" [value]="selCol.properties.name">
                  {{ selCol?.properties?.name }}
                </option>
              </select>
            </div>
            <div class="options-dd d-flex align-items-center position-relative mr-2 hover">
              <span class="fas fa-lg fa-sort-amount-down ml-2 text-muted position-absolute"
                *ngIf="sortValue.value === '-1'"></span>
              <span class="fas fa-lg fa-sort-amount-up ml-2 text-muted position-absolute"
                *ngIf="sortValue.value === '1'"></span>
              <!-- <span class="fas fa-lg fa-angle-down text-primary position-absolute angle-pos"></span> -->
              <select [(ngModel)]="col.selectedOption" #sortValue>
                <option *ngFor="let option of sortingOptions;" [value]="option.value">
                  {{option.name}}
                </option>
              </select>
            </div>
            <div class="fas fa-times text-danger hover mr-3" (click)="removeSortCols(i1)"></div>
            <div class="fas fa-plus text-primary new-row" (click)="addColForSort()"></div>
          </div>
          <button class="pl-0 text-primary font-sm btn btn-link d-flex justify-content-start" (click)="addColForSort()">
            <strong><span class="fas fa-lg fa-plus-circle mr-2"></span> Select Field</strong>
          </button>
        </div>
      </div>
      <div *ngIf="!showSaveDiv" class="d-flex justify-content-end p-3">
        <button class="mr-2 btn btn-link" (click)="clearFilter()">Clear</button>
        <button class="mr-2 btn btn-link text-success" (click)="showSaveDiv = true">{{ saveOrEditText }}</button>
        <button class="btn btn-primary mr-2 " type="button" (click)="applyFilter()">Apply</button>
        <button class="btn btn-primary" type="button" (click)="applyFilter(true)">Apply & Close</button>
      </div>
      <div *ngIf="showSaveDiv" class="d-flex justify-content-between align-items-center p-3 w-100 save-filter"
        [@toggleSaveFilter]>
        <div class="mr-2">Name your View</div>
        <input type="text" id="viewName" class="form-control w-25 mr-4"
          placeholder="Give a name (max 40 chars alphanumeric)" maxlength="40" (blur)="checkFilterName()"
          [(ngModel)]="filterData.name" [ngClass]="{'is-invalid': invalidFilterName}" pattern="/^[a-z\d\s]+$/i">
        <div class="mr-2">Share:</div>
        <div class="left-radius position-relative hover"
          [ngClass]="{'bg-white': !filterData.private, 'bg-primary': filterData.private}"
          (click)="filterData.private = true">
          <span class="fas fa-unlock-alt position-absolute icon-pos"
            [ngClass]="{'text-secondary': !filterData.private, 'text-white': filterData.private}"></span>
        </div>
        <div class="right-radius bg-white position-relative hover mr-2"
          [ngClass]="{'bg-white': filterData.private, 'bg-primary': !filterData.private}"
          (click)="filterData.private = false">
          <span class="fas fa-globe position-absolute icon-pos"
            [ngClass]="{'text-secondary': filterData.private, 'text-white': !filterData.private}"></span>
        </div>
        <div class="filter-text font-sm">
          <span *ngIf="filterData.private === true">Private (Only Me)</span>
          <span *ngIf="filterData.private !== true">Public (Anyone)</span>
        </div>
        <div class="ml-auto">
          <button class="btn btn-link" (click)="showSaveDiv = false">Cancel</button>
          <button class="btn btn-primary" (click)="saveFilter()">Save view</button>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #confirmDeleteModal>
  <div class="modal-header alert">
    <h4 class="modal-title text-danger">{{ deleteModal?.title }}</h4>
    <button id="deleteModalCloseBtn" type="button" class="close" aria-label="Close"
      (click)="confirmDeleteModalRef.close(false)">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p class="text-center">{{ deleteModal?.message }}</p>
  </div>
  <div class="modal-footer">
    <button id="deleteModalCancelBtn" type="button" class="btn btn-secondary px-4 btn-min-width"
      (click)="confirmDeleteModalRef.close(false)">No</button>
    <button id="deleteModalYesBtn" type="button" class="btn btn-danger px-4 btn-min-width"
      (click)="confirmDeleteModalRef.close(true)">Yes</button>
  </div>
</ng-template>